# nixpacks.toml

[phases.setup]
# 1. Added 'curl' specifically to break the existing cache
nixPkgs = ["nodejs-20_x", "openssl", "curl"]

[phases.install]
dependsOn = ["setup"]
# 2. Force install pnpm using npm immediately before using it
# This guarantees it exists in this layer regardless of the setup phase
cmds = ["npm install -g pnpm@9 && pnpm install"]

[phases.build]
dependsOn = ["install"]
# 3. Use pnpm to build (it should persist from the install layer)
cmds = ["pnpm build"]

[start]
cmd = "pnpm start"